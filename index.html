<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Invoice Analyzer</title>
  <style>
    /* ... (keep the existing styles) ... */
  </style>
</head>
<body>
  <div class="container">
    <!-- ... (keep the existing HTML structure) ... -->
  </div>
  <script>
    // ... (keep the existing tab functionality) ...

    // Single PDF upload
    document.getElementById('uploadFormSingle').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const fileInput = document.getElementById('pdfFileSingle');
      const uploadedFileDiv = document.getElementById('uploadedFileSingle');
      const progressBar = document.getElementById('progressBarSingle');
      const resultDiv = document.getElementById('result');

      uploadedFileDiv.textContent = `Uploaded file: ${fileInput.files[0].name}`;
      progressBar.style.width = '50%';
      progressBar.textContent = 'Uploading...';
      resultDiv.textContent = '';

      try {
        const response = await fetch('/upload', {
          method: 'POST',
          body: formData
        });
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const { jobId } = await response.json();
        await checkStatusSingle(jobId);
      } catch (error) {
        console.error('Error:', error);
        resultDiv.textContent = `An error occurred: ${error.message}`;
        progressBar.style.width = '100%';
        progressBar.textContent = 'Error';
      }
    });

    async function checkStatusSingle(jobId) {
      const progressBar = document.getElementById('progressBarSingle');
      const resultDiv = document.getElementById('result');
      progressBar.style.width = '75%';
      progressBar.textContent = 'Processing...';
      let status = 'processing';
      while (status === 'processing') {
        const response = await fetch(`/status/${jobId}`);
        const result = await response.json();
        status = result.status;
        if (status === 'completed') {
          progressBar.style.width = '100%';
          progressBar.textContent = 'Complete';
          if (typeof result.result.analysis === 'string') {
            resultDiv.textContent = result.result.analysis;
          } else {
            resultDiv.textContent = 'Unexpected analysis result format';
          }
        } else if (status === 'failed') {
          progressBar.style.width = '100%';
          progressBar.textContent = 'Error';
          resultDiv.textContent = `An error occurred: ${result.result}`;
        } else {
          await new Promise(resolve => setTimeout(resolve, 1000)); // Poll every second
        }
      }
    }

    // Compare PDFs upload
    document.getElementById('uploadFormCompare').addEventListener('submit', async function(e) {
      e.preventDefault();
      const formData = new FormData(this);
      const fileInput1 = document.getElementById('pdfFileCompare1');
      const fileInput2 = document.getElementById('pdfFileCompare2');
      const uploadedFileDiv1 = document.getElementById('uploadedFileCompare1');
      const uploadedFileDiv2 = document.getElementById('uploadedFileCompare2');
      const progressBar = document.getElementById('progressBarCompare');
      const compareResultDiv = document.getElementById('compareResult');

      uploadedFileDiv1.textContent = `Uploaded file: ${fileInput1.files[0].name}`;
      uploadedFileDiv2.textContent = `Uploaded file: ${fileInput2.files[0].name}`;
      progressBar.style.width = '50%';
      progressBar.textContent = 'Uploading...';
      compareResultDiv.textContent = '';

      try {
        const response = await fetch('/compare', {
          method: 'POST',
          body: formData
        });
        if (!response.ok) {
          throw new Error(`HTTP error! Status: ${response.status}`);
        }
        const { jobId } = await response.json();
        await checkStatusCompare(jobId);
      } catch (error) {
        console.error('Error:', error);
        compareResultDiv.textContent = `An error occurred: ${error.message}`;
        progressBar.style.width = '100%';
        progressBar.textContent = 'Error';
      }
    });

    async function checkStatusCompare(jobId) {
      const progressBar = document.getElementById('progressBarCompare');
      const compareResultDiv = document.getElementById('compareResult');
      progressBar.style.width = '75%';
      progressBar.textContent = 'Processing...';
      let status = 'processing';
      while (status === 'processing') {
        const response = await fetch(`/status/${jobId}`);
        const result = await response.json();
        status = result.status;
        if (status === 'completed') {
          progressBar.style.width = '100%';
          progressBar.textContent = 'Complete';
          if (typeof result.result.analysis1 === 'string' && typeof result.result.analysis2 === 'string') {
            compareResultDiv.innerHTML = `<div>${result.result.analysis1}</div><hr><div>${result.result.analysis2}</div>`;
          } else {
            compareResultDiv.textContent = 'Unexpected analysis result format';
          }
        } else if (status === 'failed') {
          progressBar.style.width = '100%';
          progressBar.textContent = 'Error';
          compareResultDiv.textContent = `An error occurred: ${result.result}`;
        } else {
          await new Promise(resolve => setTimeout(resolve, 1000)); // Poll every second
        }
      }
    }

    // ... (keep the existing clear button functionality) ...
  </script>
</body>
</html>